<VirtualHost *:80>
    ServerName sikeskoja.portnumbay.id
    ServerAdmin admin@portnumbay.id

    # Proxy settings
    ProxyPreserveHost On
    ProxyRequests Off

    # Frontend - serve static files from Nginx
    ProxyPass /static http://localhost:8080/static
    ProxyPassReverse /static http://localhost:8080/static

    # API - proxy to Node.js backend
    ProxyPass /api http://localhost:5000/api
    ProxyPassReverse /api http://localhost:5000/api

    # WebSocket support for API
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} =websocket [NC]
    RewriteRule /api/(.*)  ws://localhost:5000/api/$1 [P,L]

    # Uploads directory
    ProxyPass /uploads http://localhost:5000/uploads
    ProxyPassReverse /uploads http://localhost:5000/uploads

    # Health check
    ProxyPass /health http://localhost:5000/health
    ProxyPassReverse /health http://localhost:5000/health

    # All other requests to frontend (Nginx)
    ProxyPass / http://localhost:8080/
    ProxyPassReverse / http://localhost:8080/

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/sikeskoja-error.log
    CustomLog ${APACHE_LOG_DIR}/sikeskoja-access.log combined

    # Security headers
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
</VirtualHost>
